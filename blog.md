# 메쉬코리아 상점 서버 AWS EB to EKS migration

> ## **1. Table of Contents**
>
> 1. Table of Contents
> 2. 상점 서버 뭐하는 녀석인가요?
> 3. EB to EKS 왜 하게 됐나요?
> 4. EB to EKS 준비 해야했던것들.
> 5. EB to EKS 어떤 점이 변했을까
> 6. EKS 전환이 가져다준 좋은점들
> 7. EKS 전환하면서 어려웠던 점
> 8. Trouble Shooting
> 9. 어떻게 하면 더 나은 방법으로 진행할 수 있었을까?

---

>## 2. 상점 서버 뭐하는 녀석인가요?
> 상점 서버는 부릉 서비스 내부에서 배송 신청 / 상점 정보에 대한 역할을 담당하고 있습니다.  
> 

---

> ## 3. EB to EKS 왜 하게 됐을까?
>
> 1. php 7.0 EB Platform 지원 중단
> 2. Container 기반의 운영 환경 구성하기
> 3. 회사의 방향성과 보조 맞추기
>
> ### 3-1 php 7.0 EB Platform 지원 중단
>
> 상점 서버는 php7.0 EB Platform을 사용하고 있었습니다.  
> 하지만 2020년 초 AWS 측에서 php7.0 platform에 대한 공식 지원 중단 공지가 나왔었습니다.  
> php 버전업 역시 해결해야 하는 중요한 기술 부채였지만,  
> 당시 ISMS 및 비즈니스 이슈를 해결하기 위한 여러가지 프로젝트를 진행하고 있었기 때문에, 쉽지 않은 상황이었죠.  
>
> ### 3-2 Container 기반의 운영 환경 구성
>
> 최근 서버군 트랜드는 container 를 기반으로 서버 운영환경의 동일성을 추구하고 있습니다.  
> 단순히 버전업을 할 수 없는 상황이어서 만이 아니라 또 다른 기술 부채를 가지고 있던 것이죠.  
> 인프라 환경에 대한 기술부채를 해소하기 위해 EB docker platform 과 k8s 기반의 EKS 사이의 고민을 하게됩니다.
>
> ### 3-3 회사의 방향성과 보조 맞추기
>
> 부릉 서비스내의 신규 서버군은 k8s 를 향해 가고 있었습니다.  
> 상점 서버팀의 선택지는 EB docker platform / k8s 사이에서 고민하던중  
> EB Docker platform 의 경우 ecs 라는 별도의 오케스트레이션 플랫폼을 기반으로 구동한다는 것을 알게 됐습니다.  
> EB docker platform 을 선택하게 되는 경우 devops 팀의 인프라 지원에 지장이 생기게 되는 상황이었습니다.  
> 또한 사내 기술 스택을 통일하기 위해서는 EKS 를 기반으로 전환하는 것이 올바른 결정이라고 생각하게 됐습니다.
>
---
> ## 4 EB to EKS 전환 준비하기
> 상점서버의 기존 인프라 구성은 아래와 같았습니다.  
> ![alt](https://link)  
>  
> 상점 서버는 크게 큐서버군 / 크론 서버 / api 서버군 3가지 부분으로 이루어져 있습니다.  
> one source multy use 를 하던 상황이었습니다. 
> 각 서버군은 목적에 알맞는 process 를 커맨드로 등록해서 문제 상황시  
> 정상적으로 재시작 할 수 있는 구조가 되어야 했습니다. 
> 
> 
